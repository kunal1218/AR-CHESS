{
  "version": "0.2.0",
  "status": "draft",
  "description": "Shared API contract and DTO registry for AR Chess.",
  "endpoints": [
    {
      "name": "scan_room_marker",
      "method": "POST",
      "path": "/v1/rooms/scan",
      "request": {
        "marker_id": "string"
      },
      "response": {
        "room_id": "string"
      }
    },
    {
      "name": "get_room_anchors",
      "method": "GET",
      "path": "/v1/rooms/{room_id}/anchors",
      "response": {
        "anchors": "Anchor[]"
      }
    },
    {
      "name": "create_anchor",
      "method": "POST",
      "path": "/v1/rooms/{room_id}/anchors",
      "request": {
        "cloud_anchor_id": "string",
        "pose": "Pose"
      },
      "response": {
        "id": "string"
      }
    },
    {
      "name": "create_board",
      "method": "POST",
      "path": "/v1/boards",
      "request": {
        "room_id": "string",
        "initial_fen": "string?"
      },
      "response": {
        "board_id": "string",
        "fen": "string",
        "version": "number"
      }
    },
    {
      "name": "get_board",
      "method": "GET",
      "path": "/v1/boards/{board_id}",
      "response": {
        "board_id": "string",
        "fen": "string",
        "version": "number"
      }
    },
    {
      "name": "post_move",
      "method": "POST",
      "path": "/v1/boards/{board_id}/move",
      "request": {
        "uci": "string",
        "expected_version": "number"
      },
      "response": {
        "fen": "string",
        "version": "number",
        "legal": "boolean",
        "reason": "string?"
      }
    },
    {
      "name": "dev_ping",
      "method": "GET",
      "path": "/openapi.json",
      "response": {
        "openapi": "string",
        "info": "object"
      },
      "notes": "Used by the Expo client to verify LAN connectivity from an iPhone."
    },
    {
      "name": "create_game_log",
      "method": "POST",
      "path": "/v1/games",
      "response": {
        "game_id": "string"
      },
      "notes": "Creates a server-backed match log. Move notation uses UCI for Stockfish compatibility."
    },
    {
      "name": "record_game_move",
      "method": "POST",
      "path": "/v1/games/{game_id}/moves",
      "request": {
        "ply": "number",
        "move_uci": "string"
      },
      "response": {
        "game_id": "string",
        "ply": "number",
        "move_uci": "string",
        "created_at": "string"
      },
      "notes": "Accepts UCI moves like e2e4, e1g1, and e7e8q."
    },
    {
      "name": "get_game_moves",
      "method": "GET",
      "path": "/v1/games/{game_id}/moves",
      "response": {
        "game_id": "string",
        "moves": "GameMove[]"
      }
    },
    {
      "name": "enqueue_matchmaking_ticket",
      "method": "POST",
      "path": "/v1/matchmaking/enqueue",
      "request": {
        "player_id": "string"
      },
      "response": "MatchmakingTicket",
      "notes": "Creates or refreshes a queue ticket for the calling player. The server may immediately return a matched ticket."
    },
    {
      "name": "heartbeat_matchmaking_ticket",
      "method": "POST",
      "path": "/v1/matchmaking/{ticket_id}/heartbeat",
      "request": {
        "player_id": "string"
      },
      "response": "MatchmakingTicket",
      "notes": "Extends queue TTL and can opportunistically pair the ticket if another waiting player is available."
    },
    {
      "name": "get_matchmaking_ticket",
      "method": "GET",
      "path": "/v1/matchmaking/{ticket_id}",
      "request": {
        "player_id": "string?"
      },
      "response": "MatchmakingTicket"
    },
    {
      "name": "cancel_matchmaking_ticket",
      "method": "DELETE",
      "path": "/v1/matchmaking/{ticket_id}",
      "request": {
        "player_id": "string"
      },
      "response": "MatchmakingTicket"
    },
    {
      "name": "get_match_state",
      "method": "GET",
      "path": "/v1/matches/{match_id}/state",
      "request": {
        "player_id": "string?"
      },
      "response": "MatchState",
      "notes": "Returns the authoritative move list, next turn, and the caller's assigned color."
    },
    {
      "name": "record_match_move",
      "method": "POST",
      "path": "/v1/matches/{match_id}/moves",
      "request": {
        "player_id": "string",
        "ply": "number",
        "move_uci": "string"
      },
      "response": "MatchMove",
      "notes": "Returns 409 with current server state if the caller is out of turn or another move already owns that ply."
    },
    {
      "name": "get_match_moves",
      "method": "GET",
      "path": "/v1/matches/{match_id}/moves",
      "request": {
        "after_ply": "number?",
        "player_id": "string?"
      },
      "response": {
        "match_id": "string",
        "game_id": "string",
        "latest_ply": "number",
        "next_turn": "string",
        "moves": "MatchMove[]"
      }
    }
  ],
  "events": [],
  "dtos": [
    {
      "name": "Pose",
      "fields": {
        "pos": "Vector3",
        "rot": "Quaternion"
      }
    },
    {
      "name": "Vector3",
      "fields": {
        "x": "number",
        "y": "number",
        "z": "number"
      }
    },
    {
      "name": "Quaternion",
      "fields": {
        "x": "number",
        "y": "number",
        "z": "number",
        "w": "number"
      }
    },
    {
      "name": "Anchor",
      "fields": {
        "id": "string",
        "cloud_anchor_id": "string",
        "pose": "Pose",
        "active": "boolean"
      }
    },
    {
      "name": "GameMove",
      "fields": {
        "game_id": "string",
        "ply": "number",
        "move_uci": "string",
        "created_at": "string"
      }
    },
    {
      "name": "MatchmakingTicket",
      "fields": {
        "ticket_id": "string",
        "player_id": "string",
        "status": "string",
        "match_id": "string?",
        "assigned_color": "string?",
        "heartbeat_at": "string",
        "expires_at": "string",
        "poll_after_ms": "number"
      }
    },
    {
      "name": "MatchMove",
      "fields": {
        "match_id": "string",
        "game_id": "string",
        "ply": "number",
        "move_uci": "string",
        "player_id": "string",
        "created_at": "string"
      }
    },
    {
      "name": "MatchState",
      "fields": {
        "match_id": "string",
        "game_id": "string",
        "status": "string",
        "white_player_id": "string",
        "black_player_id": "string",
        "your_color": "string?",
        "latest_ply": "number",
        "next_turn": "string",
        "moves": "MatchMove[]"
      }
    }
  ]
}
